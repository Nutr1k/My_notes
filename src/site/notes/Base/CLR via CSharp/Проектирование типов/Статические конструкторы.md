---
{"dg-publish":true,"permalink":"/base/clr-via-c-sharp/proektirovanie-tipov/staticheskie-konstruktory/"}
---


Синонимы термина статический конструктор: конструкторы типов, конструкторы классов и инициализаторы типов.
Статический конструктор полезен для инициализации любых **статических полей**, связанных с типом. 


Ограничения статического конструктора:
1. Должен быть без параметров
2. Должны быть закрытыми (C# делает их закрытыми автоматически) и не допускает указание модификаторов доступа(даже самого закрытого)
3. Может инициализировать только статические поля

##### Особенности вызова статического конструктора

Конструктор типа вызывается только единожды когда это необходимо.

JIT-компилятор проверяет, был ли исполнен статический конструктор в данном домене приложений. Если нет, JIT-компилятор создает в IL-коде вызов конструктора типа. Если же код уже исполнялся, JIT-компилятор вызова конструктора типа не создает, так как «знает», что тип уже инициализирован

Статический конструктор обеспечивает потоковую безопасность т.к.  при обращении нескольких потоков к статическому конструктору, только один получает доступ, а остальные получают исключающую блокировку. Также каждый поток перед выполнением конструктора проверяет был ли он уже выполнен до него, если был - они не станут снова выполнять код, а просто вернут управление из метода конструктора.

##### Использование конструктора

C# предлагает упрощённый синтаксис для инициализации полей:

```csharp
internal sealed class SomeType 
{ 
	private static Int32 s_x = 5; 
}
```

При компоновке этого кода компилятор автоматически генерирует конструктор типа SomeType. Иначе говоря, получается тот же эффект, как если бы этот код был написан следующим образом:


```csharp
internal sealed class SomeType
{
	private static Int32 s_x;
	static SomeType() 
	{ 
		s_x = 5; 
	}
}
```

IL код данных конструкторов:
```asm
.method private hidebysig specialname rtspecialname static 
        void  .cctor() cil managed
{
  // Размер кода:       7 (0x7)
  .maxstack  8
  IL_0000:  ldc.i4.5
  IL_0001:  stsfld     int32 SomeType::s_x
  IL_0006:  ret
} // end of method SomeType::.cctor
```

В IL коде статический конструктор обозначается .cctor (от class constructor).


При генерации IL-кода статического конструктора компилятор C# сначала генерирует код инициализирующий статические поля за пределами статического конструктора(так называемая упрощённая инициализация), а затем обрабатывает явный код, содержащийся внутри метода статического конструктора.

```csharp
internal sealed class SomeType
{
	private static Int32 s_x = 5;
	static SomeType()
	{
		s_x = 10;
	}
}
```

Здесь компилятор C# генерирует единственный метод-конструктор типа, который сначала инициализирует поле s_x значением 5, затем — значением 10.

```asm
.method private hidebysig specialname rtspecialname static 
        void  .cctor() cil managed
{
  // Размер кода:       14 (0xe)
  .maxstack  8
  IL_0000:  ldc.i4.5
  IL_0001:  stsfld     int32 SomeType::s_x
  IL_0006:  ldc.i4.s   10
  IL_0008:  stsfld     int32 SomeType::s_x
  IL_000d:  ret
} // end of method SomeType::.cctor

```